<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../iron-list/iron-list.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../paper-ripple/paper-ripple.html">

<link rel="import" href="../iron-selector/iron-selector.html">
<link rel="import" href="../iron-a11y-keys/iron-a11y-keys.html">


<!--
`cr-offer-selector`
Cash Register Product Selector

@demo demo/index.html 
-->

<dom-module id="cr-offer-selector">
    <template>
        <style>
            :host {
                display: block;
                height: 100vh;
                display: flex;
                flex-direction: column;
            }

            iron-list {
                flex: 1 1 auto;
            }

            iron-list {
                --iron-list-items-container: {
                    margin: 10px;
                };
            }

            .product {
                width: 80px;
                height: 80px;
                background-color: tan;
            }

            /* Button */
            .button {
                display: inline-block;
                position: relative;
                width: 80px;
                height: 80px;
                line-height: 32px;
                border-radius: 2px;
                font-size: 0.9em;
                background-color: #fff;
                color: #646464;
            }

            .button > paper-ripple {
                border-radius: 2px;
                overflow: hidden;
            }

            .button.narrow {
                width: 60px;
            }

            .button.grey {
                background-color: #eee;
            }

            .button.blue {
                background-color: #4285f4;
                color: #fff;
            }

            .button.green {
                background-color: #0f9d58;
                color: #fff;
            }

            .button.raised {
                transition: box-shadow 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                transition-delay: 0.2s;
                box-shadow: 0 2px 5px 0 rgba(0, 0, 0, 0.26);
            }

            .button.raised:active {
                box-shadow: 0 8px 17px 0 rgba(0, 0, 0, 0.2);
                transition-delay: 0s;
            }
        </style>


        <iron-list grid id="list" items="[[offers]]"
                   as="offer" on-tap="_selectOffer">
            <template>
                <div id="offerContainer" style="padding: 5px">
                    <div class$="button raised [[offer.colorClass]]" style$="[[_computeColorStyle(offer.color)]]"
                         tabindex$="[[tabIndex]]">
                        <div class="center" fit>[[offer.product.name]]</div>
                        <div class="center" fit>[[offer.price]]</div>
                        <paper-ripple></paper-ripple>

                    </div>
                </div>
            </template>
        </iron-list>

        <iron-a11y-keys id="a11y" target="[[listTarget]]" keys="enter"
                        on-keys-pressed="onEnter"></iron-a11y-keys>

    </template>

    <script>
        Polymer({

            is: 'cr-offer-selector',

            properties: {
                /**
                 * List of offer like
                 * {
                 *                       id: 'offerId',
                 *                       price: 24,
                 *                       product: {
                 *                           name: 'Name '
                 *                       },
                 *                       colorClass: 'grey blue green',
                 *                       color: {
                 *                           'background-color': '#4285f4',
                 *                           'color': '#fff'
                 *                       }
                 *                   }
                 */
                offers: {
                    type: Array,
                    value: function () {
                        var arr = [];
                        var colors = ['grey', 'blue', 'green'];
                        var colorBlue = {
                            'background-color': '#4285f4',
                            'color': '#fff'
                        };
                        for (var pas = 1; pas < 30; pas++) {
                            arr.push({
                                        id: 'o' + pas,
                                        price: 24,
                                        product: {
                                            id: 'p' + pas,
                                            name: 'Product ' + pas
                                        },
                                        colorClass: colors[pas % colors.length],
                                        color: {
                                            'background-color': '#4285f4',
                                            'color': '#fff'
                                        }
                                    }
                            );
                        }
                        return arr;
                    }
                },
                listTarget: {
                    type: Object,
                    value: function () {
                        return this.$.list;
                    }
                }
            },
            ready: function () {
//                this.$.list.addOwnKeyBinding('enter:keypress','onEnter');
            },
            listeners: {
                enter: 'saveSelected'
            },

            /**
             *
             * @param offerStyle
             * @returns {string}
             * @private
             */
            _computeColorStyle: function (offerStyle) {
                var styleCss = '';
                if (this._isObject(offerStyle)) {
                    for (var key in offerStyle) {
                        if (offerStyle.hasOwnProperty(key)) {
                            styleCss += key+ ': ' + offerStyle[key]+'; ';
                        }
                    }
                }
                //return 'background-color: #0f9d58; color: #4285f4';
                return styleCss;
            },
            _isObject: function (item) {
                return (typeof item === "object" && !Array.isArray(item) && item !== null);
            },

            _keyselectOffer: function (e) {
                console.log(e.target);
            },
            _selectOffer: function (e) {
                var model = this.$.list.modelForElement(e.target);
                if (model) {
                    var offer = model[this.$.list.as];
                    var copie = Object.assign({}, offer);
                    copie = Object.freeze(copie);
                    console.log('fire offer-select', copie);
                    this.fire('offer-select', copie);
                }
            },
            onEnter: function (e) {
                var model = this.$.list.modelForElement(e.target);
                console.log('onEnter : ', e);
            },

        });
    </script>
</dom-module>
